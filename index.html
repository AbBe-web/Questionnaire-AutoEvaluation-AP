<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pré-consultation – Activité Physique</title>

<style>
body{font-family:Arial,sans-serif;background:#f6f7f8;margin:0}
.container{max-width:700px;margin:auto;padding:20px;background:white;min-height:100vh}
h1,h2{font-weight:600}
.btn{display:block;width:100%;padding:14px;margin:10px 0;font-size:16px;border-radius:6px;border:none;background:#007BFF;color:white}
.btn.secondary{background:#6c757d}
.progress{height:6px;background:#ddd;margin:15px 0}
.progress-bar{height:6px;background:#4caf50}
input[type=number],input[type=range]{width:100%;padding:10px;font-size:16px;margin-top:10px}
.footer{font-size:12px;color:#666;margin-top:40px}
.rgpd{font-size:12px;color:#555;margin-top:20px}
a{color:#007BFF}
</style>
</head>

<body>
<div class="container" id="app"></div>

<script>
const RGPD_URL = "https://abbe-web.github.io/Questionnaire-AutoEvaluation-AP/politique-confidentialite.html";

/*************************************************
 * ÉTAT GLOBAL
 *************************************************/
const state = {
  tool:null,
  gpaq:{},
  result:{},
  history:[]
};

/*************************************************
 * RENDER + RETOUR
 *************************************************/
function render(html,progress=0){
  state.history.push(document.getElementById("app").innerHTML);
  document.getElementById("app").innerHTML=`
    <div class="progress"><div class="progress-bar" style="width:${progress}%"></div></div>
    ${html}
  `;
}
function back(){
  if(state.history.length>0){
    document.getElementById("app").innerHTML=state.history.pop();
  }
}

/*************************************************
 * ACCUEIL
 *************************************************/
render(`
<h1>Activité physique</h1>

<p>
Questionnaire destiné à préparer votre consultation médicale.<br>
<strong>Aucune donnée n’est enregistrée.</strong><br>
<a href="${RGPD_URL}" target="_blank" rel="noopener noreferrer">
Politique de confidentialité
</a>
</p>

<button class="btn" onclick="start('gpaq')">Questionnaire détaillé (GPAQ)</button>
<button class="btn secondary" onclick="start('marshall')">Questionnaire court (Marshall)</button>
`);


function start(tool){
  state.tool=tool;
  state.gpaq={};
  state.result={};
  state.history=[];
  tool==='marshall'?marshallQ1():gpaqQ1();
}

/*************************************************
 * MARSHALL
 *************************************************/
function marshallQ1(){
  render(`
<h2>Marshall – Q1</h2>
<p>≥ 20 min d’activité intense par semaine ?</p>
<button class="btn" onclick="state.result.m1=4; marshallQ2()">≥ 3 fois</button>
<button class="btn" onclick="state.result.m1=2; marshallQ2()">1–2 fois</button>
<button class="btn" onclick="state.result.m1=0; marshallQ2()">Jamais</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,20);
}
function marshallQ2(){
  render(`
<h2>Marshall – Q2</h2>
<p>≥ 30 min d’activité modérée ?</p>
<button class="btn" onclick="finishMarshall(4)">≥ 5 fois</button>
<button class="btn" onclick="finishMarshall(2)">3–4 fois</button>
<button class="btn" onclick="finishMarshall(1)">1–2 fois</button>
<button class="btn" onclick="finishMarshall(0)">Jamais</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,40);
}
function finishMarshall(v){
  const score=state.result.m1+v;
  state.result.niveau=score>=4?'suffisamment actif':'insuffisamment actif';
  motivation();
}

/*************************************************
 * GPAQ – QUESTIONS (inchangé, validé)
 *************************************************/
function gpaqQ1(){
render(`
<h2>Travail – activité intense</h2>
<p>Votre travail implique-t-il des activités physiques intenses ?</p>
<button class="btn" onclick="state.gpaq.q1=1; gpaqQ2()">Oui</button>
<button class="btn" onclick="state.gpaq.q1=0; gpaqQ4()">Non</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,10);
}
function gpaqQ2(){render(`<p>Jours/semaine</p><input type="number" min="0" max="7" onchange="state.gpaq.q2=this.value"><button class="btn" onclick="gpaqQ3()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,20);}
function gpaqQ3(){render(`<p>Minutes/jour</p><input type="number" min="0" max="1440" onchange="state.gpaq.q3=this.value"><button class="btn" onclick="gpaqQ4()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,30);}
function gpaqQ4(){render(`<h2>Travail – activité modérée</h2><button class="btn" onclick="state.gpaq.q4=1; gpaqQ5()">Oui</button><button class="btn" onclick="gpaqQ7()">Non</button><button class="btn secondary" onclick="back()">Retour</button>`,40);}
function gpaqQ5(){render(`<p>Jours/semaine</p><input type="number" min="0" max="7" onchange="state.gpaq.q5=this.value"><button class="btn" onclick="gpaqQ6()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,50);}
function gpaqQ6(){render(`<p>Minutes/jour</p><input type="number" min="0" max="1440" onchange="state.gpaq.q6=this.value"><button class="btn" onclick="gpaqQ7()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,60);}
function gpaqQ7(){render(`<h2>Déplacements</h2><button class="btn" onclick="state.gpaq.q7=1; gpaqQ8()">Oui</button><button class="btn" onclick="gpaqQ10()">Non</button><button class="btn secondary" onclick="back()">Retour</button>`,70);}
function gpaqQ8(){render(`<p>Jours/semaine</p><input type="number" min="0" max="7" onchange="state.gpaq.q8=this.value"><button class="btn" onclick="gpaqQ9()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,75);}
function gpaqQ9(){render(`<p>Minutes/jour</p><input type="number" min="0" max="1440" onchange="state.gpaq.q9=this.value"><button class="btn" onclick="gpaqQ10()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,80);}
function gpaqQ10(){render(`<h2>Loisirs – activité intense</h2><button class="btn" onclick="state.gpaq.q10=1; gpaqQ11()">Oui</button><button class="btn" onclick="gpaqQ13()">Non</button><button class="btn secondary" onclick="back()">Retour</button>`,85);}
function gpaqQ11(){render(`<p>Jours/semaine</p><input type="number" min="0" max="7" onchange="state.gpaq.q11=this.value"><button class="btn" onclick="gpaqQ12()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,87);}
function gpaqQ12(){render(`<p>Minutes/jour</p><input type="number" min="0" max="1440" onchange="state.gpaq.q12=this.value"><button class="btn" onclick="gpaqQ13()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,88);}
function gpaqQ13(){render(`<h2>Loisirs – activité modérée</h2><button class="btn" onclick="state.gpaq.q13=1; gpaqQ14()">Oui</button><button class="btn" onclick="finishGPAQ()">Non</button><button class="btn secondary" onclick="back()">Retour</button>`,90);}
function gpaqQ14(){render(`<p>Jours/semaine</p><input type="number" min="0" max="7" onchange="state.gpaq.q14=this.value"><button class="btn" onclick="gpaqQ15()">Continuer</button><button class="btn secondary" onclick="back()">Retour</button>`,92);}
function gpaqQ15(){render(`<p>Minutes/jour</p><input type="number" min="0" max="1440" onchange="state.gpaq.q15=this.value"><button class="btn" onclick="finishGPAQ()">Terminer</button><button class="btn secondary" onclick="back()">Retour</button>`,94);}

function finishGPAQ(){
  const APim=(state.gpaq.q2||0)*(state.gpaq.q3||0)+(state.gpaq.q11||0)*(state.gpaq.q12||0);
  const APmm=(state.gpaq.q5||0)*(state.gpaq.q6||0)+(state.gpaq.q8||0)*(state.gpaq.q9||0)+(state.gpaq.q14||0)*(state.gpaq.q15||0);
  const MET=APim*8+APmm*4;

  if(MET>=3000) state.result.niveau="très actif";
  else if(MET>=600) state.result.niveau="moyennement actif";
  else state.result.niveau="insuffisamment actif";

  state.result.met=MET;
  motivation();
}

/*************************************************
 * MOTIVATION + EVA
 *************************************************/
function motivation(){
  if(state.result.niveau!=="insuffisamment actif"){
    render(`<p>Êtes-vous actif à ce niveau depuis plus de 6 mois ?</p>
    <button class="btn" onclick="state.result.stade='consolidation';evaI()">Oui</button>
    <button class="btn" onclick="state.result.stade='action';evaI()">Non</button>
    <button class="btn secondary" onclick="back()">Retour</button>`,70);
  }else{
    render(`<p>Envisagez-vous d’augmenter votre activité dans les 30 jours ?</p>
    <button class="btn" onclick="state.result.stade='préparation';evaI()">Oui</button>
    <button class="btn" onclick="state.result.stade='indétermination';evaI()">Non</button>
    <button class="btn secondary" onclick="back()">Retour</button>`,70);
  }
}
function evaI(){
  render(`<p>Importance de l’activité physique (0–10)</p>
  <input type="range" min="0" max="10" value="5" oninput="this.nextElementSibling.innerText=this.value"><div>5</div>
  <button class="btn" onclick="state.result.importance=this.previousElementSibling.previousElementSibling.value;evaC()">Continuer</button>`,85);
}
function evaC(){
  render(`<p>Confiance pour maintenir ou augmenter votre activité (0–10)</p>
  <input type="range" min="0" max="10" value="5" oninput="this.nextElementSibling.innerText=this.value"><div>5</div>
  <button class="btn" onclick="state.result.confiance=this.previousElementSibling.previousElementSibling.value;resultat()">Terminer</button>`,95);
}

/*************************************************
 * RÉSULTAT FINAL (corrigé)
 *************************************************/
function resultat(){
  render(`
<h2>Résultat</h2>
<p><strong>Niveau d’activité :</strong> ${state.result.niveau}${state.result.met?` (${state.result.met} MET-min/semaine)`:``}</p>
<p><strong>Stade motivationnel :</strong> ${state.result.stade}</p>
<p><strong>Importance de l’AP :</strong> ${state.result.importance}/10</p>
<p><strong>Confiance :</strong> ${state.result.confiance}/10</p>

<p class="footer">
Cet outil a pour objectif de préparer un échange avec votre médecin.<br>
<a href="${RGPD_URL}" target="_blank" rel="noopener noreferrer">Politique de confidentialité</a>
</p>
`,100);
}
</script>
</body>
</html>
