<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pré-consultation – Activité Physique</title>

<style>
body { font-family: Arial, sans-serif; background:#f6f7f8; margin:0; }
.container { max-width:720px; margin:auto; padding:20px; background:white; min-height:100vh; }
h1,h2,h3 { font-weight:600; margin-top:25px; }
.section { border-top:1px solid #ddd; padding-top:15px; margin-top:20px; }

.btn {
  display:block;
  width:100%;
  padding:14px;
  margin:10px 0;
  font-size:16px;
  border-radius:6px;
  border:none;
  background:#007BFF;
  color:white;
  cursor:pointer;
}
.btn.secondary { background:#6c757d; }

.progress-wrapper { margin:10px 0 20px 0; }
.progress-label {
  font-size:13px;
  color:#555;
  margin-bottom:6px;
}
.progress {
  height:8px;
  background:#ddd;
  border-radius:4px;
  overflow:hidden;
}
.progress-bar {
  height:8px;
  background:#4caf50;
  width:0%;
  transition: width 0.4s ease;
}

.footer { font-size:12px; color:#666; margin-top:40px; }
.answer { margin-left:10px; margin-top:4px; }
.rgpd { font-size:12px; color:#555; margin-top:8px; }

input[type=number], input[type=range] {
  width:100%;
  padding:10px;
  font-size:16px;
}
.time-row { display:flex; gap:10px; }
</style>
</head>

<body>
<div class="container" id="app"></div>

<script>
/*************************************************
 * ÉTAT GLOBAL
 *************************************************/
const state = {
  tool: null,
  gpaq: {},
  marshall: {},
  result: {},
  history: [],
  stepLabel: ""
};

/*************************************************
 * RENDER + RETOUR
 *************************************************/
function render(html, progress=0, save=true, label=""){
  if(save) state.history.push(document.getElementById("app").innerHTML);
  state.stepLabel = label;
  document.getElementById("app").innerHTML = `
    <div class="progress-wrapper">
      <div class="progress-label">${state.stepLabel}</div>
      <div class="progress">
        <div class="progress-bar" style="width:${progress}%"></div>
      </div>
    </div>
    ${html}
  `;
}

function back(){
  if(state.history.length>0){
    document.getElementById("app").innerHTML = state.history.pop();
  }
}
  
/*************************************************
 * ACCUEIL
 *************************************************/
render(`
<h1>Activité physique</h1>
<p>Questionnaire destiné à préparer votre consultation médicale.<br>
Aucune donnée n’est enregistrée.</p>

<div class="rgpd">
<a href="https://abbe-web.github.io/Questionnaire-AutoEvaluation-AP/politique-confidentialite.html" target="_blank">
Politique de confidentialité
</a>
</div>

<button class="btn" onclick="start('gpaq')">Questionnaire détaillé (GPAQ)</button>
<button class="btn secondary" onclick="start('marshall')">Questionnaire court (Marshall)</button>
`,0,false,"Accueil");

function start(tool){
  state.tool = tool;
  state.gpaq = {};
  state.marshall = {};
  state.result = {};
  state.history = [];
  tool==="marshall" ? marshallQ1() : gpaqQ1();
}


/*************************************************
 * MARSHALL
 *************************************************/
function marshallQ1(){
render(`
<h2>Marshall – Question 1</h2>
<p>Au cours d’une semaine habituelle, combien de fois pratiquez-vous une activité physique intense d’au moins 20 minutes ?</p>
<button class="btn" onclick="state.marshall.q1=4; marshallQ2()">≥ 3 fois / semaine</button>
<button class="btn" onclick="state.marshall.q1=2; marshallQ2()">1–2 fois / semaine</button>
<button class="btn" onclick="state.marshall.q1=0; marshallQ2()">Jamais</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,15,true,"Questionnaire d’activité physique");
}

function marshallQ2(){
render(`
<h2>Marshall – Question 2</h2>
<p>Combien de fois par semaine pratiquez-vous une activité physique modérée ou de la marche rapide pendant au moins 30 minutes ?</p>
<button class="btn" onclick="finishMarshall(4)">≥ 5 fois / semaine</button>
<button class="btn" onclick="finishMarshall(2)">3–4 fois / semaine</button>
<button class="btn" onclick="finishMarshall(1)">1–2 fois / semaine</button>
<button class="btn" onclick="finishMarshall(0)">Jamais</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,30,true,"Questionnaire d’activité physique");
}

function finishMarshall(q2){
  state.marshall.q2=q2;
  const score=state.marshall.q1+q2;
  state.result.niveau = score>=4 ? "suffisamment_actif" : "insuffisamment_actif";
  state.result.marshall_score=score;
  motivation();
}

/*************************************************
 * GPAQ — FLUX COMPLET
 *************************************************/
function gpaqQ1(){
render(`
<h2>Activité au travail – intensité élevée</h2>
<p>Votre travail implique-t-il des activités physiques intenses ?</p>
<button class="btn" onclick="state.gpaq.wi=1; gpaqQ2()">Oui</button>
<button class="btn" onclick="state.gpaq.wi=0; gpaqQ4()">Non</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,10);
}

function gpaqQ2(){
render(`
<h2>Activité au travail – intensité élevée</h2>
<p>Combien de jours par semaine ?</p>
<input type="number" min="0" max="7" onchange="state.gpaq.wi_d=this.value">
<p>Combien de temps par jour ?</p>
<div class="time-row">
<input type="number" min="0" max="23" placeholder="Heures" onchange="state.gpaq.wi_h=this.value">
<input type="number" min="0" max="59" placeholder="Minutes" onchange="state.gpaq.wi_m=this.value">
</div>
<button class="btn" onclick="gpaqQ4()">Continuer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,20);
}

function gpaqQ4(){
render(`
<h2>Activité au travail – intensité modérée</h2>
<p>Votre travail implique-t-il des activités physiques modérées ?</p>
<button class="btn" onclick="state.gpaq.wm=1; gpaqQ5()">Oui</button>
<button class="btn" onclick="state.gpaq.wm=0; gpaqQ7()">Non</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,30);
}

function gpaqQ5(){
render(`
<h2>Activité au travail – intensité modérée</h2>
<p>Combien de jours par semaine ?</p>
<input type="number" min="0" max="7" onchange="state.gpaq.wm_d=this.value">
<p>Combien de temps par jour ?</p>
<div class="time-row">
<input type="number" min="0" max="23" placeholder="Heures" onchange="state.gpaq.wm_h=this.value">
<input type="number" min="0" max="59" placeholder="Minutes" onchange="state.gpaq.wm_m=this.value">
</div>
<button class="btn" onclick="gpaqQ7()">Continuer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,40);
}

function gpaqQ7(){
render(`
<h2>Déplacements</h2>
<p>Effectuez-vous des trajets d’au moins 10 minutes à pied ou à vélo ?</p>
<button class="btn" onclick="state.gpaq.tr=1; gpaqQ8()">Oui</button>
<button class="btn" onclick="state.gpaq.tr=0; gpaqQ10()">Non</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,50);
}

function gpaqQ8(){
render(`
<h2>Déplacements</h2>
<p>Combien de jours par semaine ?</p>
<input type="number" min="0" max="7" onchange="state.gpaq.tr_d=this.value">
<p>Combien de temps par jour ?</p>
<div class="time-row">
<input type="number" min="0" max="23" placeholder="Heures" onchange="state.gpaq.tr_h=this.value">
<input type="number" min="0" max="59" placeholder="Minutes" onchange="state.gpaq.tr_m=this.value">
</div>
<button class="btn" onclick="gpaqQ10()">Continuer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,60);
}

function gpaqQ10(){
render(`
<h2>Loisirs – activité intense</h2>
<p>Pratiquez-vous des sports ou du fitness de forte intensité ?</p>
<button class="btn" onclick="state.gpaq.li=1; gpaqQ11()">Oui</button>
<button class="btn" onclick="state.gpaq.li=0; gpaqQ13()">Non</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,70);
}

function gpaqQ11(){
render(`
<h2>Loisirs – activité intense</h2>
<p>Combien de jours par semaine ?</p>
<input type="number" min="0" max="7" onchange="state.gpaq.li_d=this.value">
<p>Combien de temps par jour ?</p>
<div class="time-row">
<input type="number" min="0" max="23" placeholder="Heures" onchange="state.gpaq.li_h=this.value">
<input type="number" min="0" max="59" placeholder="Minutes" onchange="state.gpaq.li_m=this.value">
</div>
<button class="btn" onclick="gpaqQ13()">Continuer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,75);
}

function gpaqQ13(){
render(`
<h2>Loisirs – activité modérée</h2>
<p>Pratiquez-vous des activités physiques modérées en loisirs ?</p>
<button class="btn" onclick="state.gpaq.lm=1; gpaqQ14()">Oui</button>
<button class="btn" onclick="state.gpaq.lm=0; gpaqQ16()">Non</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,80);
}

function gpaqQ14(){
render(`
<h2>Loisirs – activité modérée</h2>
<p>Combien de jours par semaine ?</p>
<input type="number" min="0" max="7" onchange="state.gpaq.lm_d=this.value">
<p>Combien de temps par jour ?</p>
<div class="time-row">
<input type="number" min="0" max="23" placeholder="Heures" onchange="state.gpaq.lm_h=this.value">
<input type="number" min="0" max="59" placeholder="Minutes" onchange="state.gpaq.lm_m=this.value">
</div>
<button class="btn" onclick="gpaqQ16()">Continuer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,85);
}

/*************************************************
 * GPAQ — SÉDENTARITÉ (MODIFIÉE)
 *************************************************/
function gpaqQ16(){
render(`
<h2>Comportement sédentaire</h2>
<p>Combien de temps passez-vous assis ou couché par jour (hors sommeil) ?</p>
<div class="time-row">
<input type="number" min="0" max="23" placeholder="Heures" onchange="state.gpaq.sed_h=this.value">
<input type="number" min="0" max="59" placeholder="Minutes" onchange="state.gpaq.sed_m=this.value">
</div>
<button class="btn" onclick="finishGPAQ()">Terminer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,90);
}

function minutes(h,m){ return (Number(h||0)*60)+Number(m||0); }

function finishGPAQ(){
  const wi = (state.gpaq.wi_d||0)*minutes(state.gpaq.wi_h,state.gpaq.wi_m);
  const wm = (state.gpaq.wm_d||0)*minutes(state.gpaq.wm_h,state.gpaq.wm_m);
  const tr = (state.gpaq.tr_d||0)*minutes(state.gpaq.tr_h,state.gpaq.tr_m);
  const li = (state.gpaq.li_d||0)*minutes(state.gpaq.li_h,state.gpaq.li_m);
  const lm = (state.gpaq.lm_d||0)*minutes(state.gpaq.lm_h,state.gpaq.lm_m);

  const MET = wi*8 + li*8 + (wm+tr+lm)*4;
  state.result.met = MET;

  if(MET>=3000) state.result.niveau="très_actif";
  else if(MET>=600) state.result.niveau="moyennement_actif";
  else state.result.niveau="insuffisamment_actif";

  motivation();
}

/*************************************************
 * MOTIVATION + EVA + RÉSULTAT
 * (INCHANGÉS – GEL)
 *************************************************/
function motivation(){
  if(state.result.niveau!=="insuffisamment_actif"){
    render(`
    <h2>Motivation</h2>
    <p>Êtes-vous actif à ce niveau depuis plus de 6 mois ?</p>
    <button class="btn" onclick="state.result.stade='consolidation'; evaImportance()">Oui</button>
    <button class="btn" onclick="state.result.stade='action'; evaImportance()">Non</button>
    <button class="btn secondary" onclick="back()">Retour</button>
    `,95,true,"Motivation");
  } else {
    render(`
    <h2>Motivation</h2>
    <p>Envisagez-vous d’augmenter votre activité physique dans les 30 jours ?</p>
    <button class="btn" onclick="state.result.stade='préparation'; evaImportance()">Oui</button>
    <button class="btn" onclick="motivation2()">Non</button>
    <button class="btn secondary" onclick="back()">Retour</button>
    `,95,true,"Motivation");
  }
}

function motivation2(){
render(`
<h2>Motivation</h2>
<p>Avez-vous l’intention de vous engager dans une activité physique régulière dans les 6 mois ?</p>
<button class="btn" onclick="state.result.stade='intention'; evaImportance()">Oui</button>
<button class="btn" onclick="state.result.stade='indétermination'; evaImportance()">Non</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,96);
}

function evaImportance(){
render(`
<h2>Importance de l’activité physique</h2>
<p>Quelle importance accordez-vous à l’activité physique dans votre vie ?</p>
<input type="range" min="0" max="10" value="5"
oninput="this.nextElementSibling.innerText=this.value">
<div>5</div>
<button class="btn" onclick="state.result.importance=document.querySelector('input').value; evaConfiance()">Continuer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,97);
}

function evaConfiance(){
render(`
<h2>Confiance en soi</h2>
<p>Dans quelle mesure êtes-vous confiant(e) pour réussir à augmenter ou maintenir votre niveau d’activité physique ?</p>
<input type="range" min="0" max="10" value="5"
oninput="this.nextElementSibling.innerText=this.value">
<div>5</div>
<button class="btn" onclick="state.result.confiance=document.querySelector('input').value; final()">Terminer</button>
<button class="btn secondary" onclick="back()">Retour</button>
`,98);
}

function final(){
render(`
<h2>Résultat</h2>
<p><strong>Niveau d’activité :</strong> ${state.result.niveau.replace("_"," ")}
${state.result.met?` (${state.result.met} MET-min/semaine)`:""}</p>

<div class="section"><strong>Stade motivationnel</strong><div class="answer">${state.result.stade}</div></div>
<div class="section"><strong>Importance</strong><div class="answer">${state.result.importance}/10</div></div>
<div class="section"><strong>Confiance</strong><div class="answer">${state.result.confiance}/10</div></div>

<button class="btn secondary" onclick="back()">Retour</button>
<button class="btn secondary" onclick="location.reload()">Recommencer</button>

<p class="footer">Document à apporter lors de votre consultation médicale.</p>
`,100,false);
}
</script>
</body>
</html>
